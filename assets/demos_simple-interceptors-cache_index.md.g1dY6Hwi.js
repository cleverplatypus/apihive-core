import{m as R,H as S}from"./chunks/HTTPRequestFactory.B_LA8_EG.js";import{d as O,p as w,c as p,o as u,j as o,e as v,k as H,t as b,_ as x,C as D,G as C,a as y,w as N}from"./chunks/framework.DJIHrpKd.js";function P(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function A(t){for(const[,s]of t.entries())if(s instanceof File||s instanceof Blob)return!0;return!1}function F(t,s,e){if(t instanceof Blob||typeof File<"u"&&t instanceof File||t instanceof ArrayBuffer||P(t)||typeof ReadableStream<"u"&&t instanceof ReadableStream)return!0;if(t instanceof FormData)return A(t);if(s){const a=s.toLowerCase();return!(e==null?void 0:e.some(n=>new RegExp(n).test(a)))}return!1}function m(t){return t==null||typeof t!="object"?JSON.stringify(t):Array.isArray(t)?"["+t.map(a=>m(a)).join(",")+"]":"{"+Object.keys(t).sort().map(a=>{const i=m(t[a]);return`"${a}":${i}`}).join(",")+"}"}function L(t){let s=5381;for(let e=0;e<t.length;e++)s=(s<<5)+s+t.charCodeAt(e),s=s&s;return(s>>>0).toString(16)}class E{constructor(){this.name="request-hash",this.hashes=new WeakMap}getDelegates(s){return{request:{getHash:(e,a={includeBody:!1})=>{const i=a.includeBody?"withBody":"withoutBody";if(this.hashes.has(e)&&this.hashes.get(e)[i])return this.hashes.get(e)[i];const n=e.getReadOnlyConfig(),l=n.headers["content-type"],r=R(n.body,e);if(F(r,l,[...n.textMimeTypes,...n.jsonMimeTypes]))throw new Error("Hashing binary request bodies are not supported");if(!n.finalURL)throw new Error("Request URL is not finalised. Hashing is only valid after URL finalisation (happens during execute()).");const c={method:n.method,url:n.finalURL,queryParams:n.queryParams,urlParams:n.urlParams,body:null,relevantHeaders:{}};if(r&&a.includeBody)if(r instanceof FormData){const h=Array.from(r.entries()).sort();c.body=JSON.stringify(h)}else if(typeof r=="string")try{const h=JSON.parse(r);c.body=m(h)}catch{c.body=r}else c.body=r;const _=["content-type","accept","accept-language","accept-encoding"];for(const h of _){const f=n.headers[h]||n.headers[h.toLowerCase()];f!==void 0&&(c.relevantHeaders[h.toLowerCase()]=typeof f=="function"?f(e.getReadOnlyConfig()):f)}const k=m(c),g=L(k),B=this.hashes.get(e)||{};return this.hashes.set(e,{...B,[i]:g}),g}}}}}const I={class:"simple-interceptors-cache-demo demo pico"},V={class:"justify-between"},J={key:0},T={key:1},U=O({__name:"SimpleInterceptorsCacheDemo",setup(t){const s=w(),e=new Map,a=w(""),i=new S().use(new E).withBaseURL("https://jsonplaceholder.typicode.com").withRequestInterceptors(({controls:l})=>{l.finaliseURL();const r=l.getHash(),d=e.get(r);if(d!==void 0)return a.value="cache",d}).withResponseInterceptors(async({response:l,controls:r})=>{const d=r.getHash();try{const c=await l.clone().json();e.set(d,c),a.value="network"}catch{}}),n=async()=>{s.value=await i.createGETRequest("/posts/1").execute()};return(l,r)=>(u(),p("div",I,[o("div",V,[o("button",{onClick:n},"Call API"),o("button",{class:"secondary",onClick:r[0]||(r[0]=d=>H(e).clear())},"Clear Cache")]),o("pre",null,b(s.value),1),a.value==="cache"?(u(),p("article",J,"Response from cache")):v("",!0),a.value==="network"?(u(),p("article",T,"Response from network")):v("",!0)]))}}),q=x(U,[["__scopeId","data-v-5ac35fa4"]]),M=JSON.parse('{"title":"DEMO: Simple Cache","description":"","frontmatter":{},"headers":[],"relativePath":"demos/simple-interceptors-cache/index.md","filePath":"demos/simple-interceptors-cache/index.md"}'),K={name:"demos/simple-interceptors-cache/index.md"},G=Object.assign(K,{setup(t){return(s,e)=>{const a=D("ClientOnly");return u(),p("div",null,[e[0]||(e[0]=o("h1",{id:"demo-simple-cache",tabindex:"-1"},[y("DEMO: Simple Cache "),o("a",{class:"header-anchor",href:"#demo-simple-cache","aria-label":'Permalink to "DEMO: Simple Cache"'},"â€‹")],-1)),e[1]||(e[1]=o("p",null,"Here's a simple demo of how to use the request hash to cache responses.",-1)),e[2]||(e[2]=o("p",null,"Click the button to repeatedly call the API and see the cache in action.",-1)),e[3]||(e[3]=o("p",null,"You can verify in the network tab of your browser's devtools that requests after the first are not sent to the server.",-1)),e[4]||(e[4]=o("p",null,[y("Of course this is a very limited cache implementation. For a production-ready cache, you should use a ready made adapter like the "),o("a",{href:"https://npmjs.com/package/@apihive/adapter-simple-cache",target:"_blank",rel:"noreferrer"},[o("code",null,"@apihive/adapter-simple-cache")]),y(".")],-1)),C(a,null,{default:N(()=>[C(q)]),_:1})])}}});export{M as __pageData,G as default};
