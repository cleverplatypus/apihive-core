import{H as P}from"./chunks/HTTPRequestFactory.B_LA8_EG.js";import{c as d,o as r,a1 as w,d as S,b as R,k as e,p as C,q as A,j as t,G as E,a5 as y,a7 as o,Z as B,T as D,w as u,e as f,t as v,_ as M,C as O,a3 as N,a as c}from"./chunks/framework.DJIHrpKd.js";import{I as b}from"./chunks/InlineMessage.DZU86agj.js";const q="hcaptcha-api-script-id",I="_hcaptchaOnLoad";let m,_;const F=new Promise((i,s)=>{m=i,_=s});function U(i){if(window.hcaptcha)return m(),F;if(document.getElementById(q))return F;window[I]=m;const s=T(i),a=document.createElement("script");return a.id=q,a.src=s,a.async=!0,a.defer=!0,a.onerror=h=>{console.error("Failed to load api: "+s,h),_("Failed to load api.js")},document.head.appendChild(a),F}function T(i){let s=i.apiEndpoint;return s=k(s,"render","explicit"),s=k(s,"onload",I),s=k(s,"recaptchacompat",i.reCaptchaCompat===!1?"off":null),s=k(s,"hl",i.language),s=k(s,"sentry",i.sentry),s=k(s,"custom",i.custom),s=k(s,"endpoint",i.endpoint),s=k(s,"assethost",i.assethost),s=k(s,"imghost",i.imghost),s=k(s,"reportapi",i.reportapi),s}function k(i,s,a){if(a!=null){const h=i.includes("?")?"&":"?";return i+h+s+"="+encodeURIComponent(a)}return i}var j=(i,s)=>{for(const[a,h]of s)i[a]=h;return i};const V={name:"VueHcaptcha",props:{sitekey:{type:String,required:!0},theme:{type:String,default:void 0},size:{type:String,default:void 0},tabindex:{type:String,default:void 0},language:{type:String,default:void 0},reCaptchaCompat:{type:Boolean,default:!0},challengeContainer:{type:String,default:void 0},rqdata:{type:String,default:void 0},sentry:{type:Boolean,default:!0},custom:{type:Boolean,default:void 0},apiEndpoint:{type:String,default:"https://hcaptcha.com/1/api.js"},endpoint:{type:String,default:void 0},reportapi:{type:String,default:void 0},assethost:{type:String,default:void 0},imghost:{type:String,default:void 0}},data:()=>({widgetId:null,hcaptcha:null,renderedCb:null}),mounted(){return U(this.$props).then(this.onApiLoaded).catch(this.onError)},unmounted(){this.teardown()},destroyed(){this.teardown()},methods:{teardown(){this.widgetId&&(this.hcaptcha.reset(this.widgetId),this.hcaptcha.remove(this.widgetId))},onApiLoaded(){this.hcaptcha=window.hcaptcha;const i={sitekey:this.sitekey,theme:this.theme,size:this.size,tabindex:this.tabindex,callback:this.onVerify,"expired-callback":this.onExpired,"chalexpired-callback":this.onChallengeExpired,"error-callback":this.onError,"open-callback":this.onOpen,"close-callback":this.onClose};this.challengeContainer&&(i["challenge-container"]=this.challengeContainer),this.widgetId=this.hcaptcha.render(this.$el,i),this.rqdata&&this.hcaptcha.setData(this.widgetId,{rqdata:this.rqdata}),this.onRendered()},execute(){this.widgetId?(this.hcaptcha.execute(this.widgetId),this.onExecuted()):this.renderedCb=()=>{this.renderedCb=null,this.execute()}},executeAsync(){if(this.widgetId)return this.onExecuted(),this.hcaptcha.execute(this.widgetId,{async:!0});let i;const s=new Promise(a=>{i=a});return this.renderedCb=()=>{this.renderedCb=null,i()},s.then(this.executeAsync)},reset(){this.widgetId?(this.hcaptcha.reset(this.widgetId),this.onReset()):this.$emit("error","Element is not rendered yet and thus cannot reset it. Wait for `rendered` event to safely call reset.")},onRendered(){this.$emit("rendered"),this.renderedCb&&this.renderedCb()},onExecuted(){this.$emit("executed")},onReset(){this.$emit("reset")},onError(i){this.$emit("error",i),this.reset()},onVerify(){const i=this.hcaptcha.getResponse(this.widgetId),s=this.hcaptcha.getRespKey(this.widgetId);this.$emit("verify",i,s)},onExpired(){this.$emit("expired")},onChallengeExpired(){this.$emit("challengeExpired")},onOpen(){this.$emit("opened")},onClose(){this.$emit("closed")}}},$={id:"hcap-script"};function J(i,s,a,h,n,p){return r(),d("div",$)}var L=j(V,[["render",J]]);const g=w({token:""}),Z=S({__name:"CaptchaElement",setup(i){const s=h=>{g.token=h},a=()=>{g.token=""};return(h,n)=>(r(),R(e(L),{sitekey:"11aa5322-6cfe-417c-9844-03d8657048ea",onVerify:s,onExpired:a}))}}),H={name:"default",baseURL:"https://httpbin.org",endpoints:{"register-user":{target:"/post",method:"POST",meta:{useCaptcha:!0}},"some-other-endpoint":{target:"/post",method:"POST"}}},x=new P().withAPIConfig(H).when(i=>i.meta.useCaptcha).withRequestInterceptors(({controls:i})=>{i.replaceBody(s=>JSON.stringify(Object.assign({},JSON.parse(s),{captcha:g.token})))});class Y{constructor(){this._model=w({user:{name:"John Doe",email:"john.doe@example.com"},somethingElse:{foo:"bar"},results:{registerUser:null,doSomethingElse:null}})}get model(){return this._model}async registerUser(){const s=await x.createAPIRequest("register-user").withJSONBody(this._model.user).execute();this._model.results.registerUser=s.json}async doSomethingElse(){const s=await x.createAPIRequest("some-other-endpoint").withJSONBody(this._model.somethingElse).execute();this._model.results.doSomethingElse=s.json}}const l=new Y,G={class:"captcha-request-demo demo pico"},z={class:"flex-cols"},Q=["disabled"],W={key:0},K={key:0},X=S({__name:"CaptchaRequestDemo",setup(i){const s=C(null),a=C(null);return A(()=>l.model.results.registerUser,()=>{var h;(h=l.model.results.registerUser)!=null&&h.captcha&&s.value.show("success","Yeyy! Captcha was injected")}),A(()=>l.model.results.doSomethingElse,()=>{var h;(h=l.model.results.doSomethingElse)!=null&&h.captcha||a.value.show("success","Yeyy! Captcha NOT injected")}),(h,n)=>(r(),d("article",G,[t("form",{onSubmit:n[3]||(n[3]=B(()=>{},["prevent"]))},[n[7]||(n[7]=t("h3",null,"Register User",-1)),y(t("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=p=>e(l).model.user.name=p),placeholder:"Name"},null,512),[[o,e(l).model.user.name]]),y(t("input",{type:"email","onUpdate:modelValue":n[1]||(n[1]=p=>e(l).model.user.email=p),placeholder:"Email"},null,512),[[o,e(l).model.user.email]]),t("div",z,[t("button",{disabled:!e(g).token,onClick:n[2]||(n[2]=(...p)=>e(l).registerUser&&e(l).registerUser(...p))},"Register",8,Q),E(Z)])],32),n[9]||(n[9]=t("br",null,null,-1)),n[10]||(n[10]=t("br",null,null,-1)),E(b,{ref_key:"userInlineMessage",ref:s},null,512),E(D,null,{default:u(()=>[e(l).model.results.registerUser?(r(),d("pre",W,"PAYLOAD: "+v(e(l).model.results.registerUser),1)):f("",!0)]),_:1}),n[11]||(n[11]=t("hr",null,null,-1)),t("div",null,[n[8]||(n[8]=t("h3",null,"Do Something Else",-1)),t("form",{onSubmit:n[6]||(n[6]=B(()=>{},["prevent"]))},[y(t("input",{type:"text","onUpdate:modelValue":n[4]||(n[4]=p=>e(l).model.somethingElse.foo=p),placeholder:"foo"},null,512),[[o,e(l).model.somethingElse.foo]]),t("button",{onClick:n[5]||(n[5]=(...p)=>e(l).doSomethingElse&&e(l).doSomethingElse(...p))},"Do Something Else")],32)]),n[12]||(n[12]=t("br",null,null,-1)),n[13]||(n[13]=t("br",null,null,-1)),E(b,{ref_key:"somethingElseInlineMessage",ref:a},null,512),E(D,null,{default:u(()=>[e(l).model.results.doSomethingElse?(r(),d("pre",K,"PAYLOAD: "+v(e(l).model.results.doSomethingElse),1)):f("",!0)]),_:1})]))}}),ss=M(X,[["__scopeId","data-v-6f43d463"]]),hs=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"demos/captcha-requests/index.md","filePath":"demos/captcha-requests/index.md"}'),is={name:"demos/captcha-requests/index.md"},ls=Object.assign(is,{setup(i){return(s,a)=>{const h=O("ClientOnly");return r(),d("div",null,[a[0]||(a[0]=t("h2",{id:"demo-captcha-integration",tabindex:"-1"},[c("DEMO: Captcha Integration "),t("a",{class:"header-anchor",href:"#demo-captcha-integration","aria-label":'Permalink to "DEMO: Captcha Integration"'},"â€‹")],-1)),a[1]||(a[1]=t("p",null,"This example uses HCaptcha to inject a captcha token into the request body.",-1)),a[2]||(a[2]=t("p",null,[c("Normally it only makes sense to have only one captcha per page. So, the captcha element is here encapsulated in a reusable component that sets the captcha token in a global model that is consumed by the factory's conditional building when the API request being created has the "),t("code",null,"useCaptcha"),c(" meta property set.")],-1)),a[3]||(a[3]=t("div",{class:"tip custom-block"},[t("p",{class:"custom-block-title"},"Note"),t("p",null,"In real life it would probably be simpler just to have the conditional captcha injector straight in a request interceptor defined right in the API config or have a reusable adapter that does the same. The purpose of this example is to show a comprehensive use of the factory capabilities.")],-1)),E(h,null,{default:u(()=>[E(ss)]),_:1}),a[4]||(a[4]=N("",2))])}}});export{hs as __pageData,ls as default};
